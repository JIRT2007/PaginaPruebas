<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Estilos externos -->
  <link rel="stylesheet" href="../RECURSOS/CSS/style_calculadora.css">
  <!-- Librería de iconos (FontAwesome) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>Calculadora</title>

  <style>
    /* --- Estilo del tablero --- */
    .tablero {
      background-image: url("../RECURSOS/IMAGENES/SpriteTablero.png");
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      width: 70%;
      height: 80%;
      border: 7px solid rgba(255, 255, 255, 1);
    }

    /* Fondo desenfocado con oscurecimiento */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url("../RECURSOS/IMAGENES/fondoInicio.png");
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      filter: blur(8px) brightness(0.7);
      z-index: -1;
    }

    .icon-btn:hover {
      background-color: #45a049;
      transform: scale(1.1);
    }

  </style>
</head>

<body>
  <!-- Tablero con 7 zonas donde se pueden colocar los dinosaurios -->
  <div class="tablero" id="tablero"> 
    <div class="region region-top-left dropzone"></div>
    <div class="region region-top-right dropzone"></div>
    <div class="region region-middle-left dropzone"></div>
    <div class="region region-middle-right dropzone"></div>
    <div class="region region-bottom-left dropzone"></div>
    <div class="region region-bottom-right dropzone"></div>
    <div class="region region-center dropzone"></div>
  </div>

  <!-- Zona para tomar dinosaurios y botones de control -->
  <div class="tab" id="TomaDinosaurios">
    <div id="zona-dinos"></div> <!-- Aquí aparecen los dinos disponibles -->
    
    <span id="turno-info" style="color:black; margin-left:10px;">Tablero del jugador: 1</span>

    <!-- Botón con un icono (ejemplo: tirar dado) -->
    <button class="CalculoF" onclick="alert('¡Botón presionado!')">
      <label>Calcuar puntaje</label>
      <i class="fa-solid fa-flag-checkered"></i>
    </button>

    <!-- Botón para cambiar de turno -->
    <button class="CambioTurno" id="btn-cambiar-turno">
      <label>Siguiene jugador</label>
      <i class="fa-solid fa-users"></i>
    </button>
   
   <!-- Botón para regresar (logout) -->
    <button class="Salir"  onclick="window.location.href='../BACK/logout.php'">
      <label>Volver al inicio</label>
      <i class="fa-solid fa-right-from-bracket"></i>
    </button>
  </div>



  
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // --- Constantes y variables globales ---
    const dinosContainer = document.getElementById("zona-dinos");
    const btnCambiarTurno = document.getElementById("btn-cambiar-turno");
    const turnoInfo = document.getElementById("turno-info");

    const maxJugadores = 4;
    let turnoActual = 1;
    let dinoColocado = false;

    // Tableros de cada jugador: cada jugador tiene un objeto con las regiones
    let tableros = Array.from({ length: maxJugadores }, () => ({
      "region-top-left": [],
      "region-top-right": [],
      "region-middle-left": [],
      "region-middle-right": [],
      "region-bottom-left": [],
      "region-bottom-right": [],
      "region-center": []
    }));

    // Lista de dinosaurios disponibles (nombre e imagen)
    const dinos = [
      { nombre: "T-Rex", img: "DinoRojoSprite.png" },
      { nombre: "Triceratops", img: "DinoAmarilloSprite.png" },
      { nombre: "Stegosaurus", img: "DinoVerdeSprite.png" },
      { nombre: "Velociraptor", img: "DinoVioletaSprite.png" },
      { nombre: "Brachiosaurus", img: "DinoAzulSprite.png" },
      { nombre: "Ankylosaurus", img: "DinoNaranjaSprite.png" }
    ];

    // Límite de dinosaurios por zona del tablero
    const limitePorZona = {
      "region region-top-left dropzone": 6,
      "region region-top-right dropzone": 1,
      "region region-middle-left dropzone": 3,
      "region region-middle-right dropzone": 6,
      "region region-bottom-left dropzone": 12,
      "region region-bottom-right dropzone": 1,
      "region region-center dropzone": 60
    };

    // --- Funciones ---

    /**
     * Agrega eventos de arrastre y eliminación a un dinosaurio.
     * Permite arrastrar, eliminar con clic derecho y doble toque.
     * @param {HTMLElement} elem - Elemento dinosaurio.
     */
    function agregarEventosArrastre(elem) {
      elem.addEventListener("dragstart", (e) => {
        e.dataTransfer.setData("dino-img", elem.querySelector("img").src);
        e.dataTransfer.effectAllowed = "move";
      });

      // Elimina el dinosaurio con clic derecho
      elem.addEventListener("contextmenu", (e) => {
        e.preventDefault();
        elem.remove();
      });

      // Elimina el dinosaurio con doble toque (móvil)
      let lastTap = 0;
      elem.addEventListener("touchstart", () => {
        const currentTime = new Date().getTime();
        if (currentTime - lastTap < 300) {
          elem.remove();
        }
        lastTap = currentTime;
      });
    }

    /**
     * Genera un set inicial de dinosaurios (uno de cada tipo).
     * Los muestra en la zona de toma.
     */
    function generarDinos() {
      dinosContainer.innerHTML = "";
      dinos.forEach((dino) => {
        const dinoDiv = document.createElement("div");
        dinoDiv.className = "draggable";
        dinoDiv.draggable = true;
        dinoDiv.innerHTML = `<img src="../RECURSOS/IMAGENES/${dino.img}" alt="${dino.nombre}">`;
        agregarEventosArrastre(dinoDiv);
        dinosContainer.appendChild(dinoDiv);
      });
      dinoColocado = false;
    }

    /**
     * Guarda el estado actual del tablero del jugador.
     * @param {number} jugador - Número de jugador (1-indexado).
     */
    function guardarTablero(jugador) {
      document.querySelectorAll(".dropzone").forEach((zone) => {
        const id = zone.classList[1];
        const dinos = [];
        zone.querySelectorAll("img").forEach((img) => dinos.push(img.src));
        tableros[jugador - 1][id] = dinos;
      });
    }

    /**
     * Carga el tablero guardado del jugador actual.
     * @param {number} jugador - Número de jugador (1-indexado).
     */
    function cargarTablero(jugador) {
      document.querySelectorAll(".dropzone").forEach((zone) => {
        const id = zone.classList[1];
        zone.innerHTML = "";
        tableros[jugador - 1][id].forEach((src) => {
          const dinoDiv = document.createElement("div");
          dinoDiv.className = "draggable";
          dinoDiv.draggable = true;
          dinoDiv.innerHTML = `<img src="${src}" alt="Dino">`;
          agregarEventosArrastre(dinoDiv);
          zone.appendChild(dinoDiv);
        });
      });
    }

    // --- Eventos en zonas ---
    // Permite soltar dinosaurios en las regiones del tablero
    document.querySelectorAll(".dropzone").forEach((zone) => {
      zone.addEventListener("dragover", (e) => {
        e.preventDefault();
        zone.style.backgroundColor = "rgba(255,255,255,0.1)";
      });

      zone.addEventListener("dragleave", () => {
        zone.style.backgroundColor = "transparent";
      });

      zone.addEventListener("drop", (e) => {
        e.preventDefault();
        zone.style.backgroundColor = "transparent";

        // Límite total de dinosaurios en el tablero
        const totalDinos = document.querySelectorAll(".dropzone img").length;
        if (totalDinos >= 12) {
          alert("El tablero ya cuenta con el límite de 12 dinosaurios");
          return;
        }

        const dinoImg = e.dataTransfer.getData("dino-img");
        if (dinoImg) {
          const idZona = zone.className;
          const limite = limitePorZona[idZona];
          const cantidadActual = zone.querySelectorAll("img").length;

          if (cantidadActual >= limite) {
            alert("Este recinto alcanzó el límite de dinosaurios admitidos");
            return;
          }

          // Restricción: solo dinos del mismo tipo en region-top-left
          if (zone.classList.contains("region-top-left")) {
            const imgs = zone.querySelectorAll("img");
            if (imgs.length > 0 && imgs[0].src !== dinoImg) {
              alert("Solo puedes colocar dinosaurios del mismo tipo en esta zona");
              return;
            }
          }

          // Restricción: solo dinos diferentes en region-middle-right
          if (zone.classList.contains("region-middle-right")) {
            const imgs = zone.querySelectorAll("img");
            if (Array.from(imgs).some((img) => img.src === dinoImg)) {
              alert("Solo puedes colocar dinosaurios diferentes en esta zona");
              return;
            }
          }

          // Crear clon del dinosaurio y agregarlo a la zona
          const dinoDiv = document.createElement("div");
          dinoDiv.className = "draggable";
          dinoDiv.draggable = true;
          dinoDiv.innerHTML = `<img src="${dinoImg}" alt="Dino">`;
          agregarEventosArrastre(dinoDiv);

          zone.appendChild(dinoDiv);

          // Si ya se llenó el tablero, guarda y avisa
          const totalDinosDespues = document.querySelectorAll(".dropzone img").length;
          if (totalDinosDespues >= 12) {
            guardarTablero(turnoActual);
            alert(`Completaste tu tablero jugador ${turnoActual}, sigue con el siguiente jugador.`);
          }
        }
      });
    });

    /**
     * Cambia el turno al siguiente jugador.
     * Guarda el tablero actual y carga el siguiente.
     */
    btnCambiarTurno.addEventListener("click", () => {
      guardarTablero(turnoActual);
      turnoActual = turnoActual + 1;
      turnoInfo.textContent = `Tablero del jugador: ${turnoActual}`;
      cargarTablero(turnoActual);
      generarDinos();
    });

    // --- Inicio ---
    generarDinos();
  });
</script>


</body>
</html>

